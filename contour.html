<!doctype html>
<html>
    <head>
        <title>Scalable Rendering of Multiclass Density Maps with Parser</title>
<style>
canvas {
  border: 1px solid grey;
}
.example {
  font-weight: bold;
  float:left;
  margin:5px;
}
.clearBoth { clear:both; }

</style>        
    </head>
    <body>
        <h1>Rendition</h1>

        <script src="https://d3js.org/d3-dsv.v1.min.js"></script>
        <script src="https://d3js.org/d3-fetch.v1.min.js"></script>
        <script src="dist/bundle.js" type="text/javascript"></script>
<script>
var mcp = new MCP.MCP(), prefix = "specs/";
var configuration, interpreter;


function render(id, desc, json, do_break) {
    var body = document.getElementsByTagName('body')[0],
        div = document.createElement("div"),
        canvas = document.createElement("canvas"),
        span = document.createElement("span"),
        svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");

    div.classList.add("example");
    canvas.id = id;
    svg.id = id + '-legend';
    div.appendChild(document.createTextNode(desc));
    div.appendChild(span);
    div.appendChild(document.createElement("br"));
    div.appendChild(canvas);
    div.appendChild(svg);

  body.appendChild(div);
  if (do_break) {
      var br = document.createElement("br");
      br.classList.add('clearBoth');
      body.appendChild(br);
  }
  var conf = mcp.create_configuration(json);
  conf.load('data/').then(function(conf) {
      interp = mcp.create_interp(conf);
      console.log('interp w='+conf.width+' h='+conf.height);
      interp.setup(id);
      interpreter = interp;
      interp.interpret();
      interp.render(id);
      interp.renderLegend(id+'-legend');
  });
  canvas.onmousemove = function(e) {
          var rect = canvas.getBoundingClientRect();
          var pt = interp.pickValues(Math.floor(e.clientX-rect.left),
                                     Math.floor(e.clientY-rect.top));
          if (pt.length != 0)
              span.textContent = ' Values: '+pt.toString();
          };
  canvas.onmouseleave = function() { span.textContent = ''; }
}

render('canvas1','Linear Color Scale',
       {
           "description": "multivariate normal data",
           "data": {"url": "mn_data.json"},
           "compose": {
               "mix": "max",
               "mixing": "additive"
           }
       });

render('canvas2', 'Contour lines',
       {
           "description": "multivariate normal data",
           "data": {"url": "mn_data.json"},
           "compose": {
               "mix": "none"
           },
           "contour": { "stroke": 4}
       });


</script>
    </body>
</html>
